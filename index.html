<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rafi & Amanda ‚Äî Gift Registry</title>
  <meta name="description" content="Wedding Gift Registry Rafi & Amanda" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f8f7f4;--card:#ffffff;--text:#4E1F00;--muted:#8a6a55;--brand:#4E1F00;--brand2:#4E1F00;--ornament:78,31,0}
    *{box-sizing:border-box}
    html,body{font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text)} .wrap{max-width:430px;margin:0 auto;padding:16px}
    body{font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:430px;margin:0 auto;padding:16px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:18px 22px;background:var(--card);border-radius:18px;box-shadow:0 6px 18px rgba(0,0,0,.06)} .brand{display:flex;align-items:center;gap:14px} .logo{width:auto;max-height:56px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .title{display:flex;flex-direction:column}
    h1{font-size:clamp(20px,4vw,34px);margin:0 0 6px 0;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:14px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:none;background:var(--brand);color:#fff;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .btn-outline{background:#fff;color:var(--text);border:1px solid #e5e7eb}

    .toolbar{margin:16px 0;display:grid;grid-template-columns:1fr auto;gap:10px}
    .search{display:flex;align-items:center;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px}
    .search input{border:none;outline:none;width:100%;font-size:14px}
    select{border:1px solid #e5e7eb;background:#fff;border-radius:12px;padding:10px 12px;font-size:14px}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}

    .card{background:var(--card);border-radius:20px;overflow:hidden;box-shadow:0 6px 18px rgba(var(--ornament),.08);border:1px solid rgba(var(--ornament),.15);display:flex;flex-direction:column;opacity:0;transform:translateY(10px);transition:opacity .4s ease, transform .4s ease} .card.show{opacity:1;transform:none}
    .thumb{aspect-ratio:3/4;background:#f0f2f5;display:block;object-fit:cover;width:100%}
    .info{padding:10px 12px 4px} .type{font-size:11px;letter-spacing:.6px;text-transform:uppercase;color:var(--muted);margin-bottom:6px} .name{font-weight:800;margin:0 0 6px 0;font-size:14px;line-height:1.35} .price{color:var(--text);font-weight:700;margin-bottom:8px;font-size:13px} .price small{color:var(--muted);font-weight:600}
    .name{font-weight:700;margin:0 0 6px 0;font-size:15px;line-height:1.3}
    .price{color:var(--brand2);font-weight:800;margin-bottom:10px}
    .cta{margin-top:auto;padding:10px 12px 12px} .cta a{display:block;text-align:center;text-decoration:none;background:var(--brand);color:#fff;padding:10px 12px;border-radius:14px;font-weight:800;border:1px solid rgba(var(--ornament),.3)} .cta a:active{transform:translateY(1px)}
    .cta a{display:block;text-align:center;text-decoration:none;background:var(--brand);color:#fff;padding:10px 12px;border-radius:12px;font-weight:700}
    .cta a:active{transform:translateY(1px)}

    footer{color:var(--muted);font-size:12px;text-align:center;margin:28px 0}
    .note{font-size:13px;color:var(--muted);margin-top:6px}
    .pill{background:#ecfeff;color:#0e7490;border:1px solid #a5f3fc;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700}
  </style>
  <style>
    .badge{position:absolute;top:8px;left:8px;background:#b91c1c;color:#fff;font-weight:800;font-size:11px;padding:6px 8px;border-radius:999px;letter-spacing:.6px}
    .card{position:relative}
    .card.sold .cta a{opacity:.5;pointer-events:none}
    .sold-by{font-size:11px;color:var(--muted);margin-top:6px}
    /* Gate form */
    .gate{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);backdrop-filter:blur(4px);z-index:50}
    .gate .panel{width:min(520px,92vw);background:var(--card);border-radius:18px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .gate h2{margin:0 0 8px 0}
    .gate p{margin:0 0 14px 0;color:var(--muted)}
    .form-row{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px}
    .form-row input{border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;font-size:14px}
    .form-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  </style>
</head>
<body>
  <div class="gate" id="gate" hidden>
    <div class="panel">
      <h2>Masuk dulu ya üëã</h2>
      <p>Isi data singkat agar kami bisa mencatat pemberi hadiah. Email dan nomor hanya untuk keperluan konfirmasi.</p>
      <div class="form-row">
        <input id="buyerName" placeholder="Nama" />
        <input id="buyerPhone" placeholder="No HP" />
        <input id="buyerEmail" placeholder="Email" />
      </div>
      <div class="form-actions">
        <button class="btn btn-outline" id="skipGate">Lain kali</button>
        <button class="btn" id="saveGate">Lanjut</button>
      </div>
    </div>
  </div>
  <div class="wrap">
    <header>
      <div class="brand">
        <!-- GANTI URL LOGO DI SINI -->
        <img class="logo" src="https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=600&auto=format&fit=crop" alt="Rafi & Amanda" />
        <div class="title">
          <h1>Rafi & Amanda ‚Äî Wedding Gift Registry</h1>
          <div class="sub"><strong>Halo keluarga dan teman</strong>. Kehadiran kalian sudah cukup. Jika ingin berbagi hadiah, pilih item di bawah lalu tekan Checkout untuk menuju Shopee. Terima kasih sudah ikut membangun rumah kami.</div>
          <div class="note">Link Shopee akan membuka aplikasi Shopee di HP jika terpasang. Semua item hanya contoh. Silakan ganti daftar di bagian ‚ÄúDATA REGISTRY‚Äù.</div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="shareBtn">Share Page</button>
        <button class="btn btn-outline" id="copyLinkBtn">Copy Link</button>
      </div>
    </header>

    <div class="toolbar">
      <label class="search">
        <input id="q" placeholder="Cari item‚Ä¶" />
      </label>
      <select id="sort">
        <option value="default">Urutkan</option>
        <option value="price-asc">Harga termurah</option>
        <option value="price-desc">Harga termahal</option>
        <option value="name-asc">Nama A-Z</option>
      </select>
    </div>

    <div class="grid" id="grid"></div>

    <footer>
      <p>Made with ‚ù§Ô∏è by Rafi & Amanda ‚Ä¢ Static site, no login needed</p>
      <p class="pill">Edit daftar item di dalam file ini ‚Üí cari bagian ‚ÄúDATA REGISTRY‚Äù</p>
    </footer>
  </div>

  <script>
    // ==========================
    // DATA REGISTRY ‚Äî GANTI DI SINI
    // ==========================
    const items = [
  {
    name: "Air Fryer Digital 3 L EY145",
    type: "Air Fryer",
    price: 660000,
    image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQHp7t-5Wyi7VLEJfh-6sVo_lrcVi2oa4PxRSlUyGlkFzHdXbb0TPZJ58kaXyds&usqp=CAU",
    link: "https://s.shopee.co.id/gHpBcgUND"
  },
  {
    name: "Dispenser BSS 4600",
    type: "Dispenser",
    price: 1300000,
    image: "https://images.renos.id/production/assets/portal-assets/827/product/images/ljSC1WTkuL.webp",
    link: "https://s.shopee.co.id/8ANq6uHjEp"
  },
  {
    name: "Setrika HD1172",
    type: "Setrika",
    price: 300000,
    image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR-iKdPq9nYCtQo_5o_lch0Cp8IMk4SJt6_zQ&s",
    link: "https://s.shopee.co.id/7AVIuul5oP"
  }
];

    // ===== UTIL =====
    const fmtIDR = n => new Intl.NumberFormat("id-ID", {style:"currency", currency:"IDR", maximumFractionDigits:0}).format(n);

    // ===== BACKEND CONFIG =====
    const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbyo2xde-rKUogdQtwuNb_onCMS0ZLMKhQmNFmMe8tNfHboOvx5-Nh8a7OaxQZ7FWbc/exec"; // TODO: isi dengan URL Web App Google Apps Script, contoh: https://script.google.com/macros/s/AKfycbx.../exec
    const statusMap = {}; // id -> {status, checkout_by}

    async function apiGet(params){
      if(!ENDPOINT_URL) return null;
      const url = ENDPOINT_URL + '?' + new URLSearchParams(params);
      const res = await fetch(url, {mode:'cors'});
      if(!res.ok) throw new Error('API GET fail');
      return await res.json();
    }
    async function apiPost(payload){
      if(!ENDPOINT_URL) return null;
      const res = await fetch(ENDPOINT_URL, {
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('API POST fail');
      return await res.json();
    }

    // ===== BUYER GATE =====
    function getBuyer(){
      const raw = localStorage.getItem('buyer');
      return raw ? JSON.parse(raw) : null;
    }
    function showGate(v){ document.getElementById('gate').hidden = !v; }
    function setupGate(){
      const save = document.getElementById('saveGate');
      const skip = document.getElementById('skipGate');
      save.addEventListener('click', async () => {
        const name = document.getElementById('buyerName').value.trim();
        const phone = document.getElementById('buyerPhone').value.trim();
        const email = document.getElementById('buyerEmail').value.trim();
        if(!name) { alert('Nama wajib diisi'); return; }
        const buyer = {name, phone, email};
        localStorage.setItem('buyer', JSON.stringify(buyer));
        showGate(false);
        try{ await apiPost({action:'register', buyer}); }catch(e){}
      });
      skip.addEventListener('click', () => showGate(false));
      if(!getBuyer()) showGate(true);
    }

    // ===== CHECKOUT MARKING =====
    async function markCheckout(id, buyerName){
      statusMap[id] = {status:'SOLD', checkout_by: buyerName};
      // Persist locally as fallback
      const local = JSON.parse(localStorage.getItem('soldMap')||'{}');
      local[id] = statusMap[id];
      localStorage.setItem('soldMap', JSON.stringify(local));
      try{ await apiPost({action:'checkout', id, checkout_by: buyerName}); }catch(e){}
      apply();
    }

    async function loadStatus(){
      // load from backend if available, else from localStorage
      try{
        const data = await apiGet({fn:'status'});
        if(Array.isArray(data)){
          data.forEach(row => { statusMap[row.id] = {status: row.status, checkout_by: row.checkout_by||''}; });
          return;
        }
      }catch(e){}
      const local = JSON.parse(localStorage.getItem('soldMap')||'{}');
      Object.assign(statusMap, local);
    }

    // ===== RENDER =====
    const grid = document.getElementById("grid");
    const q = document.getElementById("q");
    const sort = document.getElementById("sort");

    function openShopee(url){
      // Universal link. Di mobile biasanya membuka app Shopee.
      window.open(url, "_blank", "noopener,noreferrer");
    }

    function render(data){
      grid.innerHTML = data.map(it => {
        const id = it.id || it.name.toLowerCase().replace(/[^a-z0-9]+/g,'-');
        const status = statusMap[id]?.status || '';
        const checkoutBy = statusMap[id]?.checkout_by || '';
        const sold = status === 'SOLD';
        return `
        <article class="card ${sold? 'sold':''}" data-id="${id}">
          ${sold ? '<div class="badge">SOLD</div>' : ''}
          <img class="thumb" loading="lazy" src="${it.image}" alt="${it.name}" />
          <div class="info">
            <div class="type">${it.type ? it.type : ''}</div>
            <h3 class="name">${it.name}</h3>
            <div class="price"><small>Harga (Estimasi)</small> ${fmtIDR(it.price)}</div>
            ${checkoutBy ? `<div class="sold-by">Checkout by ${checkoutBy}</div>` : ''}
          </div>
          <div class="cta">
            <a data-checkout href="${it.link}" target="_blank" rel="noopener" aria-label="Checkout Shopee ${it.name}">${sold? 'Sudah Dibeli' : 'Checkout di Shopee'}</a>
          </div>
        </article>`;
      }).join("");
      // attach handlers
      grid.querySelectorAll('a[data-checkout]').forEach(a => {
        a.addEventListener('click', async (ev) => {
          const card = ev.currentTarget.closest('.card');
          const id = card.dataset.id;
          const item = items.find(x => (x.id||x.name.toLowerCase().replace(/[^a-z0-9]+/g,'-'))===id);
          if(!item) return;
          const buyer = getBuyer();
          if(!buyer){ showGate(true); ev.preventDefault(); return; }
          // Optimistic mark + send to backend
          await markCheckout(id, buyer.name);
        });
      });
    }" alt="${it.name}" />
          <div class="info">
            <div class="type">${it.type ? it.type : ''}</div>
            <h3 class="name">${it.name}</h3>
            <div class="price"><small>Harga (Estimasi)</small> ${fmtIDR(it.price)}</div>
          </div>
          <div class="cta">
            <a href="${it.link}" target="_blank" rel="noopener" aria-label="Checkout Shopee ${it.name}">Checkout di Shopee</a>
          </div>
        </article>
      `).join("");
    }

    function apply(){
      const term = q.value.trim().toLowerCase();
      let list = items.filter(it => it.name.toLowerCase().includes(term));
      switch(sort.value){
        case "price-asc": list.sort((a,b)=>a.price-b.price); break;
        case "price-desc": list.sort((a,b)=>b.price-a.price); break;
        case "name-asc": list.sort((a,b)=>a.name.localeCompare(b.name)); break;
      }
      render(list);
    }

    q.addEventListener("input", apply);
    sort.addEventListener("change", apply);

    // Share & Copy
    document.getElementById("shareBtn").addEventListener("click", async () => {
      try{
        if(navigator.share){
          await navigator.share({title: document.title, text: "Gift Registry Rafi & Amanda", url: location.href});
        } else {
          await navigator.clipboard.writeText(location.href);
          alert("Link disalin");
        }
      }catch(e){ console.log(e); }
    });
    document.getElementById("copyLinkBtn").addEventListener("click", async () => {
      try{ await navigator.clipboard.writeText(location.href); alert("Link disalin"); }catch(e){ console.log(e); }
    });

    // Init
    setupGate();
    loadStatus().then(apply);

    // Scroll reveal for cards
    const obs = new IntersectionObserver(entries => {
      entries.forEach(e => { if(e.isIntersecting){ e.target.classList.add('show'); obs.unobserve(e.target); } });
    }, {threshold: 0.1});
    new MutationObserver(() => document.querySelectorAll('.card:not(.show)').forEach(el => obs.observe(el))).observe(grid, {childList:true});
  </script>
</body>
</html>
